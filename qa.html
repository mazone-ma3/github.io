<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" NAME="" CONTENT="text/html; charset=UTF-8">
<TITLE>m@3記念館 レトロパソコン QA</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFDD">
<!S><!U><!FONT COLOR="BLUE">
m@3記念館 QA 2025/5/26改<BR>
<BR>
[このサイト何]<BR>
8～32bitレトロパソコンの記念館として収集物の記念撮影した画像を上げてます<BR>
(元は博物館でも作ろうかと集めたのですがお金も尽き、10年ほったらかした挙句故障多発して止めました)<BR>
実用性を重視する趣味により初代とかよりFDD付き後期モデルに偏ってます<BR>
あまり奇麗な画像ではないですがご容赦。<BR>
<BR>
ついででレトロパソコンで何か作って動かそうというソフト研究実験室になってます<BR>
題材(習作)としてC言語でスクロールMAP表示と縦2Dシューティングゲームを上げてます<BR>
<BR>
[技術資料]<BR>
大体は図書館やネットにあります。<BR>
なお日高さんのページには氏の本の正誤表があります<BR>
<BR>
[BDS-CとSDCCとz88dkどれがいいですか]<BR>
全ては試してないので何とも。どれが速いのかも知りません<BR>
<FONT COLOR="RED">SDCCはz88dkにパッチ当ててZSDCCとして取り込まれてます。(Winでは別配布のパッチでないとうまく動かなかった→今はそうでもない?)<BR>
SCCZ80より速いけど最適化に癖があったりして動かすのに一苦労します。MSX-BASICから呼ぶとexit(0)しないとSyntax Errorになるのは直ったらしい。</FONT><BR>
SCCZ80とZSDCCではスタックに積む引数の順番が標準では逆です。<BR>
癖と言うかBIOSコール時にIXレジスタ退避してないから変数が化けてたとか、みたく。<BR>
<BR>
(LSI C-80よりSDCCやCLANGのがLSI Cメーカーの商品Webの再帰問題は速い?)<BR><BR>
SDCC4.2.0で引数のレジスタ渡しが出来るようなので調査中。<BR>
→ZSDCCではオプション --sdcccall1を付ける…がライブラリ(乗除算も?)が対応してないので駄目。--sdcccall0だと引数をレジスタとスタック両方に積むが、ドキュメントに無いのでスタックだけ見た方がいいと思われる。1だとレジスタだけになる(使用されるレジスタも一部違う。戻り値も16bitではhlからdeになる)。引数のある関数ごとに__sdcccall(1)付けるしかない。<BR>
本家のドキュメントでは1が標準とあるのでZではあえて0にしてあると思われる。<BR>
<BR>
[後期PC-88のキーボードのタイプ、HC-95の本体のタイプ]<BR>
探せば出てきます<BR>
<BR>
[HC-90/95、FM77AV40SXのD-Sub25ピンやHX-34等のRGBピン配置]<BR>
探せば出てきます<BR>
<BR>
[X1turboZのロゴの色の組み合わせ]<BR>
1～3全部違うらしい<BR>
<BR>
[無印X1とかファミコンとか割り込みじゃなくポーリングでBGM鳴ってるんですか]<BR>
らしいですね<BR>
<BR>
[ソース]<BR>
あえて清書してません(AS IS)<BR>
<BR>
[gcc6809の通し方]<BR>
ビルドに必要なパッケージ全部入れて、ちゃんとビルドできるバージョン(Cygwin32なら4_3_branchとか)を解凍してbuild-6809からmake everythingする<BR>
改行コードの問題、GCCのバージョンの互換性、カレントフォルダのパスもクリアしておく。<BR>
crt0.Sが何故かフォルダ名で誤生成されたら、フォルダに直してまっさらからもう一回。<BR>
終わったらcrt0.Sをmain呼ぶだけにいじり、crt0.oを生成。先頭番地を指定できるようアセンブラとリンカをわざわざ通すようにスクリプトを書く<BR>
インラインアセンブラの書式とラベル(行頭に_とか入れないとno headerとか出る)も直す。あとは先頭番地から実行できます。<BR>
なおnewlibの生成はできず?。tarballも間違ってました。libc.a欲しければgcc6809-CoCoが参考になります。<BR><BR>
gcc6809 CoCoで探せばCygwin用バイナリがあるらしい。今はWSL2/Ubuntuで.debがある(後述)。<BR>
<BR>
[CMOCって何]<BR>
6809のCライクコンパイラ。動かすまで難解なgcc6809に代わる物かも。ただWin版はうまく動かなかったのでCygwin等でmakeする必要あり<BR>
BASICからだとスタートアップが動かないので逆アセンブラした結果、mainの実行番地を直接呼んでます。アセンブラ・リンカ通せばいいのかもしれないけど、投げた<BR>
<FONT COLOR="RED">ビルド前にcrt.asmをいじっておくらしい。やり方は特に書かない。</FONT>0.1.58はgcc6809より遅かったけど0.1.81は幾らか速くなった。<BR>
<BR>
[何でFM77AV版は遅いのですか]<BR>
メインCPUで全部やってるからというかMMRの切り替えすぎ。サブCPUにやらせないとなのですがC言語だけではちょっと。<FONT COLOR="RED">でもメモリが無いかも。</FONT><BR>
SUB CPUをON/OFFしすぎなので見直してみた。キー入力が時々変になるのは仕方ないのかも。VRAMアクセスのためにSUB CPU止める=キー入力を取りこぼす?詰んでる。<BR>パレット版は論理演算切り忘れてるけどSCREEN@で無効化されるらしく動いてる。<BR>
→SUB CPUコマンド版を試験的に作成。若干速い。(この若干が大事)<BR>
→キーボード入力をメインでやらせるように戻した。が取りこぼすし、不具合が露呈。以下マップ表示参照。<BR>
<BR>
<FONT COLOR="RED"><B>[動かない/バグってる]</B></FONT><BR>
TOWNSのは2M以上V2.1L20以降で起動します。X68Kも2Mで動くはず。PC-88はfiles=0にして下さい。<BR><BR>
VA以外の16/32bit機及びMSXの物は動作確認してる物もありますが、後は手間と都合により実機では確認してません。<BR>
<BR>
[TOWNS HR等の電源が直らない]<BR>
トランジスタ周りの抵抗とかやられてるのかも。壊れるのはコンデンサだけでないのです。ATX化するしかないかも。電源修理は下手すると失明するので注意。<BR>
<BR>
[X68030 compact等の音量が直らない]<BR>
オペアンプ周りのスルーホールとかやられてるのかも。壊れるのはコンデンサだけでないのです。-12Vも出てるか見る。<BR>
<BR>
[gcc-ia16がWindowsでビルドできない]<BR>
WSL2入れてUbuntu版を使う。これで98や88VAが試せる。
<BR>
[gcc-ia16でI/Oポートを叩きたい]<BR>
libi86-ia16-elfをsudo apt-get installで入れて(解説には書いてない)、dos.hを#includeしてoutportb(,)/inportb()関数を使う。<BR>
-li86でリンクできる。#define _BORLANDC_SOURCEしないとWarning出る。<BR>
メモリモデルはtiny/small/mediumのようです。<BR>
何か.EXEで終了後ディスク読みに行けなかったりするので調査中。<BR>
<BR>
WatcomCやDigitalMarsCの方が速いか?→-O2で最適化してみたらどっこい。<BR>
<BR>
[USBセガサターンパッドが動かない・おかしい]<BR>
ATARI仕様ではなくてメガドライブ6ボタンパッド+CPA001やアナログパッドを選択してみて下さい。<BR>
<BR>
[ELMSTRKの山賊の館はどこですか]<BR>
山の中です。なお抜け道色々あります。<BR>
<BR>
[X1のDMA]<BR>
X1 turbo DMAで出てくるBDS Cのページ、DMAのリセットコマンドはC0ではなくてC3です。<BR>
<BR>
[LSX-Dodgers]<BR>
z88dkではMSX-DOS形式ではなくて+cpmでないと駄目らしい。<BR>
PC-88版で何故かALUが効かず暴走する。→スタックポインタがOS側でC000H以降になってしまってるため。I/O 35HでVRAM選択するとおかしくなる。無理矢理スタックポインタを変更しても変数がおかしくなる。→VRAM選択中はスタックをいじらないことで解決。<BR>
似非DOSforMSXってのもある。メモリマッパ対応ではないようなのでMGSDRVが常駐できなかった(プレイヤーでの再生はできる)。<BR><BR>
[CSCP]<BR>
77AVのDOSモード効いてない気がする。CSCPのMSX2Pは横スクロールしないしDOS1/2切り替えスイッチ無い。PC-6601は何処へ。<BR>
<BR>
[8ビット機のグラフィックツール]<BR>
PC-88はPUT@/GET@で配列とやりとりしてそれ以上はマシン語で、PC-98はDEFSEG=でプレーン指定してBLOAD/BSAVEしてた時代。MSX2はBLOAD/BSAVE,Sで行けましたが。<BR>
<FONT COLOR="RED">→作りかけだったBASICのキャラクタエディタを手直して公開しました。</FONT><BR>
<BR>
[背景との手前の重ね合わせ処理しないんですか]<BR>
したいけどメモリ食うからできない。.COM版ならできるかも。<BR>
<BR>
[TOWNS-gcc クロスコンパイル環境]<BR>
試したところFarポインタが無いのでVRAMアクセスに関数でひたすら書くしかない。サウンドドライバさえどうにかなれば。シューティングゲームテストも動かした。<BR>
gccが古い版らしく__attribute__((interrupt));は逆立ちしてもありません。<BR>
<BR>
[xdev68Kのビルド]<BR>
CF-SZ5では出来なかった。CF-QV1の方で構築して持ってきた。カーソルがOFFにならない。→B_CUROFF()の後にESCシーケンスで画面クリアしてたため。<BR>
<BR>
[elf2x68k]<BR>
インラインアセンブラはレジスタ名に%つける。pc相対アドレスは絶対アドレスに直せば一応通る(アドレスが離れすぎる?)。<BR>
<BR>
[CLANGサンプルの改訂版]<BR>
z88dkで+MSXしようとするとeZ80-CLANGではこけます。エラーの該当箇所を削れば通ります。<BR>
インライン展開させたくない時は関数名プロトタイプの後に__attribute__((noinline));を付けて下さい。(gccと同じ)<BR><BR>
[他]<BR>
メモリマップドI/Oやワークエリアを参照するにはポインタ変数を使うのではなくて#define pointer ((volatile unsigned char *)0x0000)のようにマクロ定義した方がメモリが小さくなります。(修正は当面見送ります)constともまた違うらしい。<BR><BR>
WSL2/Ubuntu上にgcc-ia16/elf2x68k/gcc6809/gcc6502/amiga-gcc(旧版)を何とか構築できました。ただ今後はLLVM-CLANGの時代かもしれず(何年後だ)。<BR>
6502はcc65が必要。C64用にコンパイルすると文字列を小文字にしないとおかしい。<BR>
6809のdebのはアセンブラ・リンカ等の書式が違うので書き直しが必要。(レジスタ変数bの挙動もおかしい/例をMAP表示に追加しました)<BR>
AMIGAのは内容古くて繋がらないサイトがあるのとgitがhttpsでないと通らないことがあるのと直接落としてあれば入れなくていい物があるので修正が必要。FD起動アプリ作るには色々サンプルの修正が必要。<BR>
elf2x68kはmake内のファイル名を小文字に統一する等の修正がコンパイル時に必要なこともあり。
<BR>
<BR>
C64/AMIGAはスプライトマルチプレクサー(ダブラー)考えないと、というところで中断。<BR>
<BR>
[PC-98のWin2000/Win98マルチブート下でWin98側が起動しなくなった]<BR>
IO.SYSをWINBOOT.SYSにリネームしてコピーしてみてください。<BR>
<BR>
[llvm-mc6809のビルド]<BR>
Ubuntuからgcc抜いてClangで通った。未完成。<BR><BR>
<A HREF="index.html">[戻]</A><BR>
</BODY>
</HTML>
